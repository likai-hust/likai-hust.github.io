---
layout: 分享小组的一份codereview checklist
title: 分享小组的一份codereview checklist
date: 2020-09-16 14:50:16
tags: [code review,规范]
categories: 
- 其他
- 技术
---
> 该文简述CodeReview该如何做，以及review什么内容，该文章重点是checklist部分，基本上每条check项背后都是一个Bug或者线上case（血泪史......）。

# 如何做CodeReview

- 代码规范：目前组内的规范是阿里Java编码规范（01-JAVA编码规范），每个人必须至少阅读一遍，并安装Idea插件。
- Review指南：即本文档。
- 总结优化：定期总结CodeReview过程及结果，并对一些点进行优化，对于文档缺失的部分进行持续更新。
- 激励机制：年度CodeReview评论最多者200元美团卡。
<!--more-->

## review时间
一轮测试完成之前完成Review

## Review过程
- 单次查看代码不多于500行
- 单次审查建议不要超过30分钟

# CodeReview Checklist
## Bug检查
### 编码问题
- 检查包装类型拆包空指针：例如—基本类型与包装类型比较、包装类型赋值给基本类型）
- 检查引用对象为null触发空指针：例如—A.getData().getX()
- 并发集合key、value为null触发空指针（ConcurrentHashMap）
- if判断逻辑正确性检查（!符号等的运用是否写反）
- 对象相等比较是否使用正确（包装类型须使用Objects.equals、枚举类型须使用==）

### 安全问题
- 常量集合是否被程序修改？一般集合是否被多线程并发修改。
- ThreadLocal使用结束后是否正确清理。
- 线程池的线程数设置是否经过详细的思考，具体如何得出的。
- 检查是否存在死循环、无限递归可能。
- 金额相关字段在涉及到元转分/分转元的时候，转换方法是否正确，是否存在精度问题。
- 是否存在敏感日志未进行脱敏处理。

### 兼容性问题
- Thrift新增字段必须为Optional
- Thrift IDL禁止调整已有字段编号、顺序
- Thrift map结构是否存在null value或null key（序列怀会触发空指针异常）
- 多系统是否存在上线顺序依赖（兼容性问题，建议系统间不相互依赖）
- Thrift枚举必须手动设置，且尽量不要调整枚举的顺序（Thrift枚举序列化依赖枚举值，未设值得枚举若调整了顺序，则会发生序列化和反序列化错乱问题）
- maven引入新包是否存在包冲突问题

### 异常处理
- 异常日志处理是否正确？是否会触发大量error误告警？是否会影响程序性能？
- 新增下游的强弱依赖是否处理正确？弱依赖是否阻塞流程？
- Json反序列化是否考虑格式异常/兼容，触发序列化抛异常问题。
- 字符串转Number是否考虑参数异常，触发NumberFormat异常问题？
- 引用工具抛出的异常是否有检查，是否被正确处理。
- 对Adapter层的异常捕获是否仅是TException。

### 新增RPC检查
- 新增下游是否可降级？降级处理是否正确。
- 下游超时设置是否合理。
- 高QPS情况下下游是否有压测？压测是否符合预期。
- 新增Thrift接口是否接入鉴权。

## 非功能要求
- 工具：新增代码中是否有修改/新增 Util工具类，禁止造轮子行为，统一收敛到Adam（业务无关），Common SDK（业务相关）中，形成复用和沉淀；
- 命名：方法、类、变量命名是否具备可阅读性。
- 注释：变量、方法、类注释是否有，是否清晰？
- 常量定义：检查代码中魔法值、硬编码，检查是否需要定义常量或者动态配置。
- 代码设计：
	- 重复方法检查。
	- 多重循环嵌套、多重if嵌套（一般不要超过3层）。
	- 是否存在大函数、大类？
- 单测：
	- 单元测试是否完整。
	- 单测是否有断言，断言是否合理。